#!/usr/bin/env ruby -Ilib
# -*- coding:utf-8; mode:ruby; -*-

require "revdev"
require "optparse"

USAGE = <<__EOF
usage: #{$0} event_device

  display the infomation about event_device.

example: #{$0} /dev/input/event2

options:
  -t EV_XXX, --type EV_XXX: restrict event type (EV_XXX) to display
__EOF

def main
  include Revdev

  spec_type = nil
  OptionParser.new do |opt|
    opt.on '-t TYPE', '--type TYPE', String do |type|
      spec_type = type
    end
    opt.parse! ARGV
  end

  if ARGV.length != 1
    puts USAGE
    exit false
  end

  evdev = EventDevice.new ARGV.first
  puts "## Device Name: #{evdev.device_name}"
  puts "spec_type: #{spec_type}" if $DEBUG

  loop do
    ie = evdev.read_input_event
    next if spec_type and spec_type != ie.hr_type.to_s
    puts "type:#{ie.hr_type}	code:#{ie.hr_code or ie.code}	value:#{ie.hr_value or ie.value}"
  end

end

main if $0 == __FILE__
